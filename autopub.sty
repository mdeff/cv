% most code taken from https://davidpowell.github.io/latex-publication-list.html

\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{publications}[2020/04/17 LaTeX package to create a list of publications]

\RequirePackage[backend=biber, url=false, doi=false, isbn=false, style=phys, biblabel=brackets, sorting=ydnt, texencoding=utf8,
defernumbers=true]{biblatex}
\RequirePackage[normalem]{ulem}  % for \uline
\RequirePackage{kvoptions}  % for key-value package options

\DeclareStringOption{authorlastname}  % select entries with author and underline them
\DeclareStringOption{startyear}  % show recent papers (entries without year are ignored)
\ProcessKeyvalOptions*

% underline authors which match the given last name
\DeclareNameFormat{author}{%
	\ifthenelse{\equal{\namepartfamily}{\autopub@authorlastname}}%
		{\uline{\ifblank{\namepartgiveni}{}{\namepartgiveni\space}\namepartfamily}}%
		{\ifblank{\namepartgiveni}{}{\namepartgiveni\space}\namepartfamily}%
	\ifthenelse{\value{listcount}<\value{liststop}}%
		{\addcomma\space}
		{}
}

% only include items where one author match the given last name
\DeclareBibliographyCategory{byname}
\DeclareIndexNameFormat{byname}{% Test could be refined
	\ifboolexpr{test {\ifdefstring{\autopub@authorlastname}{#1}}}
	{\addtocategory{byname}{\thefield{entrykey}}}
	{}
}

% only include items more recent than given year
\defbibcheck{recent}{
	\ifboolexpr{not test {\iffieldint{year}} or test {\ifnumless{\thefield{year}}{\autopub@startyear}}}
	{\skipentry}{}
}

\DeclareBibliographyCategory{relevant}

% Inform biblatex that all relevant citations deserve
% special treatment, while all others do not
\AtEveryBibitem{%
  \ifcategory{relevant}%
    {* }%
    {}%
}

% get rid of the annoying word "In:" for the numeric biblatex style
\renewbibmacro{in:}{}
  
% get rid of the language entry
\AtEveryBibitem{\clearlist{language}}

\AtDataInput{%
  \indexnames[byname][1-99]{author}}

% avoid trying to justify text, as this can lead to overfull boxes
\renewcommand*{\bibfont}{\raggedright}

\newcommand{\showbooks}{\printbibliography[title={Books}, type=book, check=recent]}
\newcommand{\showchapters}{\printbibliography[title={Book Chapters}, type=inbook, check=recent, heading=subbibliography]}
\newcommand{\showarticles}{\printbibliography[title={Journal Articles}, type=article, check=recent, heading=subbibliography]}
\newcommand{\showproceedings}{\printbibliography[title={Conference Proceedings}, type=inproceedings, check=recent, heading=subbibliography]}

\endinput
