% most code taken from https://davidpowell.github.io/latex-publication-list.html

\NeedsTeXFormat{LaTeX2e}[1994/06/01]
\ProvidesPackage{publications}[2020/04/17 LaTeX package to create a list of publications]

\RequirePackage[backend=biber, url=false, doi=false, isbn=false, style=phys, biblabel=brackets, sorting=ydnt, texencoding=utf8,
defernumbers=true]{biblatex}
\RequirePackage[normalem]{ulem}  % for \uline
\RequirePackage{kvoptions}  % for key-value package options

\DeclareStringOption{authorlastname}  % select entries with author and underline them
\DeclareStringOption{startyear}  % show recent papers (entries without year are ignored)
\ProcessKeyvalOptions*

% underline authors which match the given last name
\DeclareNameFormat{author}{%
	\ifthenelse{\equal{\namepartfamily}{\autopub@authorlastname}}%
		{\uline{\ifblank{\namepartgiveni}{}{\namepartgiveni\space}\namepartfamily}}%
		{\ifblank{\namepartgiveni}{}{\namepartgiveni\space}\namepartfamily}%
	\ifthenelse{\value{listcount}<\value{liststop}}%
		{\addcomma\space}
		{}
}

% only include items where one author match the given last name
\DeclareSourcemap{\maps[datatype=bibtex]{\map{
	\step[fieldsource=author, match=\autopub@authorlastname, final]
	\step[fieldset=keywords, fieldvalue=ownpubs]
}}}

% only include items more recent than given year
\defbibcheck{recent}{
	\ifboolexpr{not test {\iffieldint{year}} or test {\ifnumless{\thefield{year}}{\autopub@startyear}}}
	{\skipentry}{}
}

\DeclareBibliographyCategory{relevant}

% Inform biblatex that all relevant citations deserve
% special treatment, while all others do not
\AtEveryBibitem{%
  \ifcategory{relevant}%
    {* }%
    {}%
}

% get rid of the annoying word "In:" for the numeric biblatex style
\renewbibmacro{in:}{}
  
% get rid of the language entry
\AtEveryBibitem{\clearlist{language}}

% avoid trying to justify text, as this can lead to overfull boxes
\renewcommand*{\bibfont}{\raggedright}

\newcommand{\autopubbytype}{
	\section*{Publications}
	\printbibliography[title={Books}, type=book, keyword=ownpubs, check=recent, heading=subbibliography]
	\printbibliography[title={Book Chapters}, type=inbook, keyword=ownpubs, check=recent, heading=subbibliography]
	\printbibliography[title={Journal Articles}, type=article, keyword=ownpubs, check=recent, heading=subbibliography]
	\printbibliography[title={Conference Proceedings}, type=inproceedings, keyword=ownpubs, check=recent, heading=subbibliography]
}

\endinput
